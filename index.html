<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rammed Earth - Finding Each Other</title>
    <meta name="description" content="To find a rammed earth builder in your locality visit directory">
    <link rel="icon" type="image/x-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect fill='%238B4513' x='10' y='30' width='80' height='40' rx='2'/><rect fill='%23CD853F' x='10' y='35' width='80' height='8'/><rect fill='%23D2691E' x='10' y='48' width='80' height='8'/><rect fill='%23F4A460' x='10' y='61' width='80' height='4'/></svg>">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: Georgia, serif;
            line-height: 1.6;
            color: #3E2723;
            background: #F5F2E8;
            padding: 20px;
            max-width: 700px;
            margin: 0 auto;
        }
        
        .container {
            background: white;
            padding: 40px 30px;
            border-radius: 3px;
            box-shadow: 0 4px 12px rgba(139, 69, 19, 0.1);
            margin-bottom: 30px;
        }
        
        h1 {
            font-size: 1.9em;
            margin-bottom: 10px;
            font-weight: normal;
            color: #8B4513;
        }
        
        .subtitle {
            font-style: italic;
            color: #D2691E;
            margin-bottom: 30px;
            font-size: 1.1em;
        }
        
        .intro {
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 1px solid #CD853F;
            color: #3E2723;
            font-size: 1.05em;
        }
        
        .section-tabs {
            display: flex;
            margin-bottom: 30px;
            border-bottom: 2px solid #CD853F;
        }
        
        .tab {
            flex: 1;
            padding: 15px;
            background: #F5F2E8;
            border: none;
            font-family: Georgia, serif;
            font-size: 1em;
            cursor: pointer;
            color: #8B4513;
            transition: all 0.3s;
        }
        
        .tab.active {
            background: #8B4513;
            color: white;
        }
        
        .tab:hover:not(.active) {
            background: #D2691E;
            color: white;
        }
        
        .section {
            display: none;
        }
        
        .section.active {
            display: block;
        }
        
        .question-block {
            margin-bottom: 30px;
        }
        
        .question {
            margin-bottom: 10px;
            font-style: italic;
            color: #8B4513;
            font-size: 1.05em;
            font-weight: 500;
        }
        
        textarea, input[type="text"], input[type="email"], select {
            width: 100%;
            padding: 15px;
            font-family: Georgia, serif;
            font-size: 0.95em;
            border: 2px solid #CD853F;
            background: #FEFCF7;
            transition: all 0.3s;
            border-radius: 3px;
        }
        
        textarea {
            min-height: 120px;
            resize: vertical;
        }
        
        select {
            height: 50px;
        }
        
        textarea:focus, input:focus, select:focus {
            outline: none;
            border-color: #8B4513;
            background: white;
            box-shadow: 0 0 0 3px rgba(139, 69, 19, 0.1);
        }
        
        .submit-btn {
            background: #8B4513;
            color: white;
            border: none;
            padding: 15px 30px;
            font-family: Georgia, serif;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s;
            width: 100%;
            border-radius: 3px;
            margin-top: 20px;
        }
        
        .submit-btn:hover {
            background: #6D3410;
        }
        
        .submit-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .response-message {
            display: none;
            padding: 25px;
            margin-top: 30px;
            border-radius: 3px;
            border-left: 5px solid #8B4513;
        }
        
        .response-message.visible {
            display: block;
        }
        
        .response-message.red-flag {
            background: #FFF3E0;
            border-left-color: #D2691E;
        }
        
        .response-message.proceed {
            background: #F1F8E9;
            border-left-color: #8B4513;
        }
        
        .response-message.directory {
            background: #E3F2FD;
            border-left-color: #2196F3;
        }
        
        .response-message h3 {
            margin-bottom: 15px;
            font-weight: normal;
            color: #8B4513;
        }
        
        .response-message p {
            color: #3E2723;
            margin-bottom: 15px;
        }
        
        .resource-list {
            margin-top: 15px;
            padding: 15px;
            background: white;
            border: 1px solid #CD853F;
            border-radius: 3px;
        }
        
        .resource-list ul {
            list-style: none;
            padding-left: 0;
        }
        
        .resource-list li {
            padding: 8px 0;
            color: #3E2723;
            border-bottom: 1px solid #F5F2E8;
        }
        
        .resource-list li:before {
            content: "→ ";
            color: #D2691E;
            font-weight: bold;
        }
        
        .directory-link {
            display: inline-block;
            background: #2196F3;
            color: white;
            padding: 12px 25px;
            text-decoration: none;
            border-radius: 3px;
            margin-top: 15px;
            transition: all 0.3s;
        }
        
        .directory-link:hover {
            background: #1976D2;
        }
        
        .contact-link {
            display: inline-block;
            background: #8B4513;
            color: white;
            padding: 12px 25px;
            text-decoration: none;
            border-radius: 3px;
            margin-top: 15px;
            transition: all 0.3s;
        }
        
        .contact-link:hover {
            background: #6D3410;
        }
        
        .substack-link {
            text-align: center;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #CD853F;
        }
        
        .substack-link a {
            color: #8B4513;
            text-decoration: none;
            font-style: italic;
        }
        
        .substack-link a:hover {
            color: #D2691E;
        }
        
        .workshop-form {
            display: grid;
            gap: 20px;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        .tech-transfer-intro {
            margin-bottom: 30px;
            padding: 20px;
            background: #FFF8E1;
            border-left: 4px solid #FFB300;
            color: #3E2723;
        }
        
        .tech-transfer-intro h3 {
            margin-bottom: 10px;
            color: #8B4513;
            font-weight: normal;
        }
        
        .terms-section {
            margin-top: 30px;
            padding: 25px;
            background: #FFF8E1;
            border: 2px solid #8B4513;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(139, 69, 19, 0.1);
        }
        
        .terms-section h4 {
            margin-bottom: 15px;
            color: #8B4513;
            font-weight: normal;
        }
        
        .terms-section ul {
            list-style: none;
            padding-left: 0;
            margin-bottom: 20px;
        }
        
        .terms-section li {
            padding: 5px 0;
            color: #3E2723;
        }
        
        .terms-section li:before {
            content: "• ";
            color: #D2691E;
            font-weight: bold;
        }
        
        .terms-checkbox {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 15px;
            padding: 15px;
            background: white;
            border-radius: 5px;
            border: 1px solid #CD853F;
        }
        
        .terms-checkbox input[type="checkbox"] {
            width: 18px;
            height: 18px;
            accent-color: #8B4513;
        }
        
        .terms-checkbox label {
            color: #3E2723;
            font-size: 0.95em;
            cursor: pointer;
        }
        
        .error-message {
            display: none;
            color: #D32F2F;
            font-size: 0.9em;
            margin-top: 10px;
            padding: 10px;
            background: #FFEBEE;
            border-radius: 3px;
            border-left: 4px solid #D32F2F;
        }
        
        @media (max-width: 600px) {
            body {
                padding: 10px;
            }
            .container {
                padding: 25px 20px;
            }
            .form-row {
                grid-template-columns: 1fr;
            }
            .section-tabs {
                flex-direction: column;
            }
        }

            .directory-pill {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: .45rem .9rem;
            border: 1px solid #CD853F;
            border-radius: 999px;
            color: #8B4513;
            font-size: .95rem;
            text-decoration: none;      /* underline removed */
            background: #FEFCF7;
            font-family: Georgia, serif;
            cursor: pointer;
            transition: all .2s ease;
        }

    .directory-pill:hover {
        color: #3E2723;
        border-color: #8B4513;
        background: #FFF8EF;
        box-shadow: 0 0 0 3px rgba(139,69,19,.15);
    }

    </style>
</head>
<body>
    <div class="container">
        <h1>The Rammed Earth Chronicles</h1>
        <div class="subtitle">For those who understand that earth building is consciousness work</div>
        
        <div class="intro">
            I help people with rammed earth through workshops and consultations - but I don't build for you. 
            If you want someone to construct your building for a quote, you need a contractor, not a consultant. 
            There are excellent people who do the job. Click the button below to find someone in your location. 
            This pages is for people who want to learn the craft themselves, who've already heard the earth calling. 
            <br></br>
         <a href="directory.html" class="directory-pill">
            Find a rammed earth builder located near you
        </a>
        <span style="margin: 0 10px; color: #8B4513;">or</span>
        <a href="submit.html" class="directory-pill" style="background:#E8F5E9;border-color:#4CAF50;color:#2E7D32;">
            Submit your listing to the directory
        </a>


        
            
            <div style="margin-top: 25px; padding: 20px; background: #FFF8E1; border-left: 4px solid #8B4513; font-size: 0.95em;">
                <strong>Choose your path:</strong><br>
                → <strong>Consultation:</strong> You want to build your own rammed earth project and need guidance<br>
                → <strong>Workshops:</strong> You want to learn with others when I organize group sessions<br>
                → <strong>Tech Transfer:</strong> You're a professional (architect/engineer/builder) wanting to integrate rammed earth into your practice
                <div class="response-message" id="tech-response">
                <!-- Tech transfer response will be inserted here -->
            </div>
        </div>
        
        <!-- Instructions Section -->
        <div id="instructions" class="section">
            <h2 style="color: #8B4513; margin-bottom: 20px;">How to Respond Effectively</h2>
            
            <div style="margin-bottom: 30px;">
                <h3 style="color: #8B4513; font-size: 1.2em; margin-bottom: 10px;">Why Detail Matters</h3>
                <p>Your responses help me understand not just what you've done, but how you think about earth building. Short answers like "nothing yet" or "budget constraints" don't give enough context.</p>
            </div>
            
            <div style="margin-bottom: 30px; padding: 20px; background: #F1F8E9; border-left: 4px solid #8B4513;">
                <h3 style="color: #8B4513; font-size: 1.2em; margin-bottom: 15px;">Good vs. Inadequate Responses</h3>
                
                <div style="margin-bottom: 20px;">
                    <strong style="color: #D32F2F;">❌ Too Brief:</strong> "nothing yet"<br>
                    <strong style="color: #2E7D32;">✓ Better:</strong> "I haven't built with rammed earth yet, but I've been experimenting with cob in small garden walls. I'm drawn to rammed earth because I want to understand how compression changes the structural possibilities compared to hand-formed earth."
                </div>
                
                <div style="margin-bottom: 20px;">
                    <strong style="color: #D32F2F;">❌ Too Brief:</strong> "expensive"<br>
                    <strong style="color: #2E7D32;">✓ Better:</strong> "My primary hurdle is that I can't find skilled labor in my region who understand rammed earth. I'm willing to learn hands-on myself, but I need guidance on the learning curve and whether it's realistic for an owner-builder."
                </div>
                
                <div>
                    <strong style="color: #D32F2F;">❌ Too Brief:</strong> "it's hard"<br>
                    <strong style="color: #2E7D32;">✓ Better:</strong> "When my test wall cracked after the first rain, I realized I had used too much clay in the mix. It taught me that I was rushing to build rather than taking time to understand the material's properties first."
                </div>
            </div>
            
            <div style="margin-bottom: 30px;">
                <h3 style="color: #8B4513; font-size: 1.2em; margin-bottom: 10px;">What Makes a Strong Response</h3>
                <ul style="list-style: none; padding-left: 0;">
                    <li style="padding: 8px 0; color: #3E2723;">→ <strong>Specificity:</strong> Mention actual materials, techniques, or experiences</li>
                    <li style="padding: 8px 0; color: #3E2723;">→ <strong>Honesty:</strong> It's fine to be a beginner - just explain your situation clearly</li>
                    <li style="padding: 8px 0; color: #3E2723;">→ <strong>Context:</strong> Help us understand your constraints, goals, and thinking</li>
                    <li style="padding: 8px 0; color: #3E2723;">→ <strong>Reflection:</strong> Show what you've learned or what questions you're grappling with</li>
                    <li style="padding: 8px 0; color: #3E2723;">→ <strong>Length:</strong> Aim for 2-4 sentences per question minimum</li>
                </ul>
            </div>
            
            <div style="padding: 20px; background: #FFF3E0; border: 2px solid #D2691E; border-radius: 8px;">
                <strong>Remember:</strong> This isn't a test with right answers. I want to understand where you are in your journey with earth building. Detailed, honest responses help me determine if and how I can help you.
            </div>
            
            <div style="margin-top: 30px; text-align: center;">
                <button onclick="showSection('consultation')" class="submit-btn" style="width: auto; display: inline-block;">Back to Consultation Form</button>
                <button onclick="showSection('tech-transfer')" class="submit-btn" style="width: auto; display: inline-block; margin-left: 15px; background: #D2691E;">Back to Tech Transfer Form</button>
            </div>
        </div>
        </div>
        
        <div class="section-tabs">
            <button class="tab active" onclick="showSection('consultation')">Consultation</button>
            <button class="tab" onclick="showSection('workshop')">Workshops</button>
            <button class="tab" onclick="showSection('tech-transfer')">Tech Transfer</button>
            <button class="tab" onclick="showSection('instructions')">How to Respond</button>
        </div>
        
        <!-- Consultation Section -->
        <div id="consultation" class="section active">
            <div style="margin-bottom: 25px; padding: 20px; background: #FFF8E1; border-left: 4px solid #D2691E; font-size: 0.95em;">
                <strong>Please provide detailed responses.</strong> Short or one-word answers don't give us enough context to understand your situation. The more specific you are about your experience, motivations, and challenges, the better we can help. <a href="#instructions" style="color: #8B4513;" onclick="showInstructions(); return false;">See detailed instructions →</a>
            </div>
            
            <form id="consultation-form">
                <div class="question-block">
                    <div class="question">What have you already tried to build?</div>
                    <textarea name="tried" placeholder="If nothing yet, just say 'nothing yet' - but tell me what draws you to earth building..." required></textarea>
                </div>
                
                <div class="question-block">
                    <div class="question">Why do you want to build with rammed earth?</div>
                    <textarea name="why" placeholder="The real reason. What calls you to this material?" required></textarea>
                </div>
                
                <div class="question-block">
                    <div class="question">What's your primary hurdle?</div>
                    <textarea name="hurdle" placeholder="If you've built: what stopped you from continuing? If you haven't: what's preventing you from starting?" required></textarea>
                </div>
                
                <div class="question-block" id="failure-question" style="display: none;">
                    <div class="question">What did the earth teach you when it failed?</div>
                    <textarea name="failure" placeholder="Not the technical lesson. What did you understand about yourself when the wall cracked?"></textarea>
                </div>
                
                <input type="email" placeholder="Your email" required>
                <button type="submit" class="submit-btn">Send</button>
            </form>
            
            <div class="response-message" id="response">
                <!-- Response will be inserted here -->
            </div>
        </div>
        
        <!-- Workshop Section -->
        <div id="workshop" class="section">
            <p style="margin-bottom: 30px; color: #3E2723;">
                Workshops happen when enough conscious people gather in one region. 
                Leave your details and I'll notify you when something forms near you.
            </p>
            
            <form class="workshop-form" id="workshop-form">
                <input type="text" placeholder="Your name" required>
                <div class="form-row">
                    <input type="email" placeholder="Email" required>
                    <input type="text" placeholder="Location (city, region)" required>
                </div>
                <button type="submit" class="submit-btn">Notify Me of Workshops</button>
            </form>
            
            <div class="response-message" id="workshop-response">
                <!-- Workshop response will be inserted here -->
            </div>
        </div>
        
        <!-- Tech Transfer Section -->
        <div id="tech-transfer" class="section">
            <div class="tech-transfer-intro">
                <h3>Technology Transfer for Professionals</h3>
                <p>For architects, engineers, and builders who want to integrate rammed earth knowledge into their practice. This is knowledge transfer, not project execution.</p>
                <p style="margin-top: 10px;"><strong>Important:</strong> Detailed responses help us understand your readiness. Brief answers make it difficult to assess fit. <a href="#instructions" style="color: #8B4513;" onclick="showInstructions(); return false;">See response guidelines →</a></p>
            </div>
            
            <form id="tech-transfer-form">
                <div class="question-block">
                    <div class="question">What's your role in rammed earth projects?</div>
                    <select name="role" required>
                        <option value="">Select your role...</option>
                        <option value="architect">I'm the architect designing it</option>
                        <option value="engineer">I'm the engineer consulting on it</option>
                        <option value="builder">I'm a builder wanting to add this skill</option>
                        <option value="contractor">I'm a contractor looking for subcontractors</option>
                        <option value="representative">I'm representing a client who wants to build</option>
                        <option value="other">Other</option>
                    </select>
                </div>
                
                <div class="question-block">
                    <div class="question">Describe your hands-on experience with building materials OR your willingness to get personally involved.</div>
                    <textarea name="hands-on" placeholder="Past experience: What materials? What did you learn physically? OR Future willingness: Are you ready to get your hands dirty learning alongside your team?" required></textarea>
                </div>
                
                <div class="question-block">
                    <div class="question">What specific rammed earth technology do you want to learn?</div>
                    <textarea name="technology" placeholder="Be specific: mix design, formwork systems, soil testing, construction sequencing..." required></textarea>
                </div>
                
                <div class="question-block">
                    <div class="question">How will you use this knowledge?</div>
                    <textarea name="application" placeholder="Training team for ongoing practice? One-time project? Adding to service offerings?" required></textarea>
                </div>
                
                <input type="email" placeholder="Your email" required>
            </form>
            
            <div class="terms-section">
                <h4>Technology Transfer Terms</h4>
                <ul>
                    <li>Knowledge transfer only - I don't execute projects</li>
                    <li>You build, I guide the technical process</li>
                    <li>Requires genuine hands-on commitment from your team</li>
                    <li>Focus on long-term capability building, not quick fixes</li>
                </ul>
                
                <div class="terms-checkbox">
                    <input type="checkbox" id="accept-terms" onchange="toggleSubmitButton()">
                    <label for="accept-terms">I have read and accept these terms</label>
                </div>
                
                <div class="error-message" id="terms-error">
                    Please read and accept the terms before submitting.
                </div>
                
                <button type="submit" class="submit-btn" id="tech-submit-btn" disabled onclick="handleTechSubmit()">Submit for Review</button>
            </div>
        </div>
        
        <div class="substack-link">
            <a href="https://rammedearth.substack.com/" target="_blank">Read and Engage →</a>
        </div>
    </div>
    
    <script>
        /*
         * QUIZ EVALUATION SYSTEM - Enhanced Version
         *
         * Improvements implemented:
         *
         * 1. CONTEXT-AWARE KEYWORD MATCHING
         *    - Detects negations ("not cheap" vs "cheap")
         *    - Uses phrases instead of isolated words
         *    - Reduces false positives
         *
         * 2. ANSWER QUALITY METRICS
         *    - Vocabulary richness (unique words / total words)
         *    - Sentence count and complexity
         *    - Specificity detection (numbers, examples, concrete details)
         *    - Generic answer detection (copy-paste patterns)
         *
         * 3. WEIGHTED SCORING SYSTEM
         *    - Consultation: 20 possible points across 4 categories
         *    - Tech Transfer: 20 possible points across 3 categories
         *    - Percentage-based thresholds instead of arbitrary numbers
         *    - Different weights for depth vs surface-level responses
         *
         * 4. DYNAMIC CLASSIFICATION
         *    - Consultation: 60%+ conscious, 40-60% developing, 25-40% beginner, 15-25% theoretical, <15% not-ready
         *    - Tech Transfer: 65%+ qualified, 45-65% developing, 30-45% willing beginner, <30% not-qualified
         *    - Borderline cases (±5% of thresholds) flagged for human review
         *
         * 5. HUMAN REVIEW FLAGS
         *    - Borderline scores automatically flagged
         *    - Low individual category scores flagged
         *    - Generic/template responses flagged
         *    - All flags sent to Google Sheets for admin review
         *
         * 6. DEBUG MODE
         *    - Add ?debug=true to URL to see scoring breakdown
         *    - Shows detailed scores, flags, and reasoning
         *    - Helps refine scoring algorithm over time
         *
         * 7. ENHANCED DATA CAPTURE
         *    - Percentage scores logged to Google Sheets
         *    - Flags and reasoning sent for analysis
         *    - Category breakdown for tech transfer
         */

        function showSection(sectionName) {
            // Hide all sections
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            
            // Show selected section
            document.getElementById(sectionName).classList.add('active');
            
            // Highlight corresponding tab if it exists
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => {
                if (tab.textContent.toLowerCase().includes(sectionName.split('-')[0])) {
                    tab.classList.add('active');
                }
            });
            
            // Scroll to top smoothly
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
        
        function showInstructions() {
            showSection('instructions');
        }
        
        // Toggle submit button based on terms acceptance
        function toggleSubmitButton() {
            const checkbox = document.getElementById('accept-terms');
            const submitBtn = document.getElementById('tech-submit-btn');
            const errorMsg = document.getElementById('terms-error');
            
            if (checkbox.checked) {
                submitBtn.disabled = false;
                submitBtn.style.opacity = '1';
                errorMsg.style.display = 'none';
            } else {
                submitBtn.disabled = true;
                submitBtn.style.opacity = '0.5';
            }
        }
        
        // Check if failure question should be shown
        document.querySelector('[name="tried"]').addEventListener('input', function() {
            const value = this.value.toLowerCase();
            const failureQuestion = document.getElementById('failure-question');
            
            if (value.includes('nothing') || value.includes('never') || value.length < 20) {
                failureQuestion.style.display = 'none';
                failureQuestion.querySelector('textarea').required = false;
            } else {
                failureQuestion.style.display = 'block';
                failureQuestion.querySelector('textarea').required = true;
            }
        });
        
        // Enhanced answer quality analysis
        function analyzeAnswerQuality(text) {
            const sentences = text.split(/[.!?]+/).filter(s => s.trim().length > 10);
            const words = text.toLowerCase().split(/\s+/);
            const uniqueWords = new Set(words);

            return {
                sentenceCount: sentences.length,
                wordCount: words.length,
                vocabularyRichness: uniqueWords.size / words.length, // 0-1 score
                avgSentenceLength: words.length / Math.max(sentences.length, 1),
                hasSpecifics: /\d+|specific|example|instance|time when|tried|built|made/.test(text.toLowerCase())
            };
        }

        // Context-aware keyword detection (checks for negations)
        function contextualMatch(text, keyword) {
            const lowerText = text.toLowerCase();
            const index = lowerText.indexOf(keyword.toLowerCase());
            if (index === -1) return false;

            // Check for negation words before keyword (within 10 chars)
            const before = lowerText.substring(Math.max(0, index - 20), index);
            const negations = ['not', "n't", 'no', 'never', 'without', 'except', 'but'];
            return !negations.some(neg => before.includes(neg));
        }

        // Check if answer is generic/copy-paste
        function isGenericAnswer(text) {
            const genericPhrases = [
                'i am interested in',
                'i would like to',
                'please help me',
                'i want to learn',
                'it is important',
                'this is important'
            ];
            const matchCount = genericPhrases.filter(phrase =>
                text.toLowerCase().includes(phrase)
            ).length;

            return matchCount >= 2; // Multiple generic phrases suggests low effort
        }

        // Analyze consultation responses with improved logic
        function analyzeResponse(answers) {
            const [tried, why, hurdle, failure] = answers;
            const debug = { scores: {}, flags: [], reasoning: [] };

            // Check for cost-focused responses (RED FLAG) - but with context
            const costPhrases = ['save money', 'cost less', 'cheaper than', 'budget constraint', 'can\'t afford'];
            const costWords = ['cheap', 'cheaper', 'budget', 'economic', 'affordable', 'inexpensive'];

            let costFocused = false;
            if (costPhrases.some(phrase => why.toLowerCase().includes(phrase))) {
                costFocused = true;
                debug.flags.push('Direct cost-focused phrases detected');
            } else if (costWords.filter(word => contextualMatch(why, word)).length >= 2) {
                costFocused = true;
                debug.flags.push('Multiple cost keywords without negation');
            }

            // Check if cost is mentioned but with learning context
            const learningContext = /learn|understand|craft|skill|knowledge|experience/.test(why.toLowerCase());
            if (costFocused && learningContext && why.length > 100) {
                costFocused = false; // Give benefit of doubt if they elaborate
                debug.reasoning.push('Cost mentioned but balanced with learning focus');
            }

            if (costFocused && !learningContext) {
                debug.reasoning.push('Primary motivation appears cost-driven');
                return { level: 'cost-focused', debug };
            }

            // Check for construction service requests (RED FLAG)
            const contractPhrases = ['build for me', 'build my', 'hire you', 'your team', 'you build', 'give me a quote'];
            if (contractPhrases.some(phrase => why.toLowerCase().includes(phrase))) {
                debug.reasoning.push('Requesting construction service, not learning');
                return { level: 'wants-contractor', debug };
            }

            // Quality check
            const triedQuality = analyzeAnswerQuality(tried);
            const whyQuality = analyzeAnswerQuality(why);
            const hurdleQuality = analyzeAnswerQuality(hurdle);

            // Generic answer detection
            if (isGenericAnswer(why) || isGenericAnswer(tried)) {
                debug.flags.push('Generic/template-like responses detected');
            }

            // Analyze consciousness level with weighted scoring
            let consciousness = 0;
            let maxScore = 0;

            // Experience markers (0-5 points)
            maxScore += 5;
            const isNothingYet = /nothing yet|haven't|never|no experience/i.test(tried);

            if (!isNothingYet && tried.length > 80) {
                consciousness += 1.5;
                debug.scores.experienceLength = 1.5;
            } else if (!isNothingYet && tried.length > 50) {
                consciousness += 0.5;
                debug.scores.experienceLength = 0.5;
            }

            if (triedQuality.hasSpecifics) {
                consciousness += 1.5;
                debug.scores.experienceSpecifics = 1.5;
            }

            // Material knowledge
            const materials = ['mix', 'clay', 'sand', 'soil', 'aggregate', 'water', 'ratio', 'moisture'];
            const materialMentions = materials.filter(m => tried.toLowerCase().includes(m)).length;
            if (materialMentions >= 2) {
                consciousness += 1.5;
                debug.scores.materialKnowledge = 1.5;
            } else if (materialMentions === 1) {
                consciousness += 0.5;
                debug.scores.materialKnowledge = 0.5;
            }

            // Failure/learning experience
            const failureWords = ['fail', 'crack', 'collaps', 'mistake', 'wrong', 'learned'];
            if (failureWords.some(word => tried.toLowerCase().includes(word))) {
                consciousness += 1;
                debug.scores.learningFromFailure = 1;
            }

            // Motivation markers (0-5 points)
            maxScore += 5;
            const deepMotivation = ['understand', 'connect', 'rhythm', 'craft', 'consciousness', 'relationship', 'material', 'calling'];
            const surfaceMotivation = ['sustainable', 'natural', 'earth', 'eco', 'green'];

            const deepMatches = deepMotivation.filter(m => contextualMatch(why, m)).length;
            const surfaceMatches = surfaceMotivation.filter(m => contextualMatch(why, m)).length;

            if (deepMatches >= 2) {
                consciousness += 2.5;
                debug.scores.deepMotivation = 2.5;
            } else if (deepMatches >= 1) {
                consciousness += 1.5;
                debug.scores.deepMotivation = 1.5;
            } else if (surfaceMatches >= 1) {
                consciousness += 0.5;
                debug.scores.surfaceMotivation = 0.5;
            }

            // Check for personal journey language
            if (/I feel|I sense|drawn to|calls me|calling|journey/i.test(why)) {
                consciousness += 1.5;
                debug.scores.personalJourney = 1.5;
            }

            // Sentence complexity in motivation
            if (whyQuality.sentenceCount >= 3 && whyQuality.vocabularyRichness > 0.6) {
                consciousness += 1;
                debug.scores.motivationDepth = 1;
            }

            // Self-awareness markers (0-4 points)
            maxScore += 4;
            const internalHurdles = ['myself', 'patience', 'knowledge', 'understanding', 'confidence', 'fear', 'learning'];
            const externalHurdles = ['money', 'time', 'resources', 'tools', 'permit'];

            const internalMatches = internalHurdles.filter(h => hurdle.toLowerCase().includes(h)).length;
            const externalMatches = externalHurdles.filter(h => hurdle.toLowerCase().includes(h)).length;

            if (internalMatches >= 2 || (internalMatches >= 1 && hurdleQuality.hasSpecifics)) {
                consciousness += 2.5;
                debug.scores.selfAwareness = 2.5;
            } else if (internalMatches >= 1) {
                consciousness += 1.5;
                debug.scores.selfAwareness = 1.5;
            } else if (externalMatches >= 1 && hurdle.length > 60) {
                consciousness += 0.5;
                debug.scores.externalAwareness = 0.5;
            }

            if (hurdleQuality.sentenceCount >= 2) {
                consciousness += 1;
                debug.scores.hurdleDepth = 1;
            }

            // Deep understanding markers from failure question (0-6 points)
            maxScore += 6;
            if (failure && failure.length > 40) {
                const failureQuality = analyzeAnswerQuality(failure);
                const reflectiveWords = ['patience', 'humble', 'listen', 'teach', 'show', 'mirror', 'realize', 'understand', 'respect', 'relationship'];
                const reflectiveMatches = reflectiveWords.filter(w => failure.toLowerCase().includes(w)).length;

                if (reflectiveMatches >= 2 && failureQuality.sentenceCount >= 2) {
                    consciousness += 4;
                    debug.scores.deepReflection = 4;
                } else if (reflectiveMatches >= 2) {
                    consciousness += 2.5;
                    debug.scores.deepReflection = 2.5;
                } else if (reflectiveMatches >= 1) {
                    consciousness += 1.5;
                    debug.scores.deepReflection = 1.5;
                }

                if (failureQuality.hasSpecifics) {
                    consciousness += 1;
                    debug.scores.specificFailure = 1;
                }
            }

            // Calculate percentage score
            const percentScore = (consciousness / maxScore) * 100;
            debug.totalScore = consciousness.toFixed(1);
            debug.maxScore = maxScore;
            debug.percentScore = percentScore.toFixed(1);

            // Dynamic thresholds based on percentage
            let level;
            if (percentScore >= 60) {
                level = 'conscious';
                debug.reasoning.push('High consciousness score - shows deep understanding and genuine engagement');
            } else if (percentScore >= 40) {
                level = 'developing';
                debug.reasoning.push('Developing consciousness - genuine interest with room to deepen');
            } else if (percentScore >= 25) {
                level = 'beginner';
                debug.reasoning.push('Beginning stage - basic interest, needs foundational experience');
            } else if (percentScore >= 15) {
                level = 'theoretical';
                debug.reasoning.push('Theoretical understanding - lacks hands-on engagement');
            } else {
                level = 'not-ready';
                debug.reasoning.push('Very low engagement - may need to explore interest further');
            }

            // Flag borderline cases for human review
            if (percentScore >= 35 && percentScore <= 45) {
                debug.flags.push('BORDERLINE - Recommend human review');
            }

            return { level, debug };
        }
        
        // Analyze tech transfer responses with enhanced logic
        function analyzeTechTransfer(answers) {
            const [role, handsOn, technology, application] = answers;
            const debug = { scores: {}, flags: [], reasoning: [] };

            // Auto-reject patterns with context
            if (role === 'contractor' || role === 'representative') {
                debug.reasoning.push('Role indicates seeking contractors, not knowledge transfer');
                return { level: 'redirect-to-directory', debug };
            }

            const quickProjectPhrases = ['one project', 'single project', 'one-time', 'quick turnaround', 'urgent'];
            if (quickProjectPhrases.some(phrase => application.toLowerCase().includes(phrase))) {
                debug.reasoning.push('Application indicates one-off project, not long-term capability building');
                return { level: 'redirect-to-directory', debug };
            }

            if (technology.toLowerCase().includes('cheap') || technology.toLowerCase().includes('fast')) {
                debug.reasoning.push('Focus on speed/cost rather than knowledge depth');
                return { level: 'redirect-to-directory', debug };
            }

            // Quality analysis
            const handsOnQuality = analyzeAnswerQuality(handsOn);
            const techQuality = analyzeAnswerQuality(technology);
            const appQuality = analyzeAnswerQuality(application);

            if (handsOn.length < 30) {
                debug.reasoning.push('Insufficient detail about hands-on involvement');
                return { level: 'no-hands-on-response', debug };
            }

            // Check for unwillingness with context awareness
            const unwillingPhrases = ['no time for', 'too busy to', 'will delegate', 'my team will handle', 'others will do', 'supervise only', 'design only'];
            const unwillingWords = ['delegate', 'supervise'];

            let hasUnwillingPhrase = unwillingPhrases.some(phrase => handsOn.toLowerCase().includes(phrase));
            let hasUnwillingContext = unwillingWords.filter(word => contextualMatch(handsOn, word)).length >= 1;

            if (hasUnwillingPhrase || (hasUnwillingContext && !handsOn.toLowerCase().includes('but') && !handsOn.toLowerCase().includes('however'))) {
                debug.reasoning.push('Indicates unwillingness for hands-on engagement');
                return { level: 'unwilling-hands-on', debug };
            }

            // Start weighted scoring
            let totalScore = 0;
            let maxScore = 0;

            // Hands-on willingness AND experience (0-8 points)
            maxScore += 8;
            let handsOnScore = 0;

            // Willingness markers
            const willingPhrases = ['willing to', 'ready to get', 'want to learn', 'eager to', 'committed to'];
            const willingWords = ['willing', 'ready', 'hands-on', 'personally', 'myself', 'learn by doing'];

            const willingPhraseMatches = willingPhrases.filter(phrase => handsOn.toLowerCase().includes(phrase)).length;
            const willingWordMatches = willingWords.filter(word => contextualMatch(handsOn, word)).length;

            if (willingPhraseMatches >= 1 || willingWordMatches >= 2) {
                handsOnScore += 2;
                debug.scores.willingness = 2;
            } else if (willingWordMatches >= 1) {
                handsOnScore += 1;
                debug.scores.willingness = 1;
            }

            // Material experience
            const materials = ['clay', 'mud', 'concrete', 'earth', 'soil', 'mortar', 'plaster'];
            const materialMentions = materials.filter(m => handsOn.toLowerCase().includes(m)).length;
            if (materialMentions >= 2) {
                handsOnScore += 2;
                debug.scores.materialExperience = 2;
            } else if (materialMentions >= 1) {
                handsOnScore += 1;
                debug.scores.materialExperience = 1;
            }

            // Technical experience
            const technicalTerms = ['mix', 'ratio', 'water', 'compression', 'formwork', 'testing'];
            const techMentions = technicalTerms.filter(t => handsOn.toLowerCase().includes(t)).length;
            if (techMentions >= 2) {
                handsOnScore += 2;
                debug.scores.technicalExperience = 2;
            } else if (techMentions >= 1) {
                handsOnScore += 1;
                debug.scores.technicalExperience = 1;
            }

            // Tactile/learning language
            const tactileWords = ['hands', 'touch', 'feel', 'experience'];
            const learningWords = ['fail', 'mistake', 'learn', 'understand'];
            if (tactileWords.some(w => handsOn.toLowerCase().includes(w))) {
                handsOnScore += 1;
                debug.scores.tactileAwareness = 1;
            }
            if (learningWords.some(w => handsOn.toLowerCase().includes(w))) {
                handsOnScore += 1;
                debug.scores.learningOrientation = 1;
            }

            // Specificity bonus
            if (handsOnQuality.hasSpecifics && handsOnQuality.sentenceCount >= 3) {
                handsOnScore += 1;
                debug.scores.handsOnDetail = 1;
            }

            totalScore += handsOnScore;

            // Technology specificity (0-6 points)
            maxScore += 6;
            let techScore = 0;

            // Specific technical areas
            const techAreas = ['mix design', 'soil testing', 'formwork', 'construction sequence', 'compression', 'moisture', 'curing', 'stabilization'];
            const techAreaMentions = techAreas.filter(area => technology.toLowerCase().includes(area)).length;

            if (techAreaMentions >= 3) {
                techScore += 3;
                debug.scores.technicalBreadth = 3;
            } else if (techAreaMentions >= 2) {
                techScore += 2;
                debug.scores.technicalBreadth = 2;
            } else if (techAreaMentions >= 1) {
                techScore += 1;
                debug.scores.technicalBreadth = 1;
            }

            // Check for specific questions/challenges
            if (/how to|how do|what is|understanding|learn about/i.test(technology)) {
                techScore += 1;
                debug.scores.specificQuestions = 1;
            }

            // Length and detail
            if (techQuality.sentenceCount >= 3 && technology.length > 100) {
                techScore += 2;
                debug.scores.technicalDetail = 2;
            } else if (technology.length > 60) {
                techScore += 1;
                debug.scores.technicalDetail = 1;
            }

            totalScore += techScore;

            // Application seriousness (0-6 points)
            maxScore += 6;
            let appScore = 0;

            // Long-term commitment indicators
            const longTermWords = ['practice', 'ongoing', 'long-term', 'capability', 'building', 'develop', 'integrate'];
            const longTermMatches = longTermWords.filter(w => contextualMatch(application, w)).length;

            if (longTermMatches >= 3) {
                appScore += 3;
                debug.scores.longTermCommitment = 3;
            } else if (longTermMatches >= 2) {
                appScore += 2;
                debug.scores.longTermCommitment = 2;
            } else if (longTermMatches >= 1) {
                appScore += 1;
                debug.scores.longTermCommitment = 1;
            }

            // Team/organizational language
            if (/team|staff|organization|company|practice/i.test(application)) {
                appScore += 1;
                debug.scores.organizationalContext = 1;
            }

            // Professional growth language
            if (/skill|knowledge|capability|expertise|competence/i.test(application)) {
                appScore += 1;
                debug.scores.professionalGrowth = 1;
            }

            // Specificity
            if (appQuality.hasSpecifics && appQuality.sentenceCount >= 2) {
                appScore += 1;
                debug.scores.applicationDetail = 1;
            }

            totalScore += appScore;

            // Calculate percentage
            const percentScore = (totalScore / maxScore) * 100;
            debug.totalScore = totalScore.toFixed(1);
            debug.maxScore = maxScore;
            debug.percentScore = percentScore.toFixed(1);
            debug.breakdown = {
                handsOn: `${handsOnScore}/8`,
                technology: `${techScore}/6`,
                application: `${appScore}/6`
            };

            // Dynamic classification
            let level;
            if (percentScore >= 65) {
                level = 'qualified-professional';
                debug.reasoning.push('Strong professional readiness - hands-on commitment, technical specificity, and long-term vision');
            } else if (percentScore >= 45) {
                level = 'developing-professional';
                debug.reasoning.push('Genuine professional interest with room to strengthen commitment or specificity');
            } else if (percentScore >= 30) {
                level = 'willing-beginner-professional';
                debug.reasoning.push('Shows willingness but needs more hands-on foundation or technical clarity');
            } else {
                level = 'not-qualified';
                debug.reasoning.push('Insufficient readiness for professional knowledge transfer at this time');
            }

            // Flag borderline cases
            if (percentScore >= 40 && percentScore <= 50) {
                debug.flags.push('BORDERLINE - Recommend human review');
            }

            // Special flags
            if (handsOnScore <= 2) {
                debug.flags.push('LOW hands-on score - may need more practical engagement');
            }
            if (techScore <= 1) {
                debug.flags.push('LOW technical specificity - unclear what they want to learn');
            }
            if (appScore <= 1) {
                debug.flags.push('LOW application clarity - unclear how knowledge will be used');
            }

            return { level, debug };
        }
        
        // Landing page mappings for consultation results
        const consultationLandingPages = {
            'conscious': 'consultation-conscious.html',
            'developing': 'consultation-developing.html',
            'beginner': 'consultation-beginner.html',
            'theoretical': 'consultation-theoretical.html',
            'not-ready': 'consultation-not-ready.html',
            'cost-focused': 'consultation-cost-focused.html',
            'wants-contractor': 'consultation-wants-contractor.html'
        };

        function generateConsultationResponse(level, email, debug) {
            const responses = {
                'cost-focused': {
                    title: "Different Paths for Different Needs",
                    content: "I appreciate your interest in rammed earth. From your responses, it seems budget efficiency is your primary driver. Rammed earth requires significant time, labor, and learning investment - it's chosen for its values, not its economics.",
                    action: "For cost-focused projects, you'll be better served by experienced contractors who work within conventional timelines. I maintain a curated directory of professionals who can help.",
                    class: "directory",
                    showDirectory: true
                },
                'wants-contractor': {
                    title: "I Hear What You Need",
                    content: "Thank you for reaching out. Based on your inquiry, you're looking for someone to build your project - which is completely valid. I focus on teaching and knowledge transfer rather than project execution.",
                    action: "I can connect you with skilled contractors from my curated directory who specialize in rammed earth construction.",
                    class: "directory",
                    showDirectory: true
                },
                'conscious': {
                    title: "Let's Talk",
                    content: "Your responses show real understanding of this work. I'd like to have a conversation with you.",
                    action: "I'll reach out within a week to discuss your journey with rammed earth.",
                    class: "proceed",
                    showContact: true
                },
                'developing': {
                    title: "You're Finding Your Way",
                    content: "I can see you have genuine interest and the right instincts. What you need now is more direct experience with earth to deepen your understanding.",
                    action: "Here are some next steps that will prepare you well. When you've worked through these, I'd welcome hearing from you again.",
                    class: "proceed",
                    resources: [
                        "Build something small that must survive one full season",
                        "Work with earth for 30 days without tutorials - just you and the material",
                        "Document what goes wrong, not what goes right",
                        "Find local earth builders and spend time observing their process"
                    ]
                },
                'beginner': {
                    title: "A Good Place to Start",
                    content: "Thank you for your honest responses. Earth building asks for embodied knowledge that develops through direct experience - there's no shortcut to this learning.",
                    action: "Start with these fundamentals. They'll give you the foundation you need.",
                    class: "proceed",
                    resources: [
                        "Test your local soil - learn about clay content, sand ratios, organic matter",
                        "Make 20 test bricks and let each one fail in its own way",
                        "Read 'Earth Construction Handbook' by Gernot Minke",
                        "Spend time with earth before trying to build with it - feel its properties"
                    ]
                },
                'theoretical': {
                    title: "The Material Comes First",
                    content: "I appreciate your interest. Right now, there's a gap between your curiosity and hands-on engagement with earth as a material.",
                    action: "Earth building begins with earth itself, not ideas about earth. Start there.",
                    class: "proceed",
                    resources: [
                        "Get your hands dirty - make mud, understand how it responds to water",
                        "Visit existing rammed earth buildings in your area, touch the walls",
                        "Start a daily practice of working with clay or earth in small ways",
                        "When you've actually experienced failure with the material, come back"
                    ]
                },
                'not-ready': {
                    title: "Perhaps Take More Time",
                    content: "Thank you for reaching out. Based on your responses, I sense you may still be in the very early stages of exploring this interest.",
                    action: "Spend time understanding whether earth building truly calls to you. When you're ready to engage more deeply, the door is open.",
                    class: "red-flag",
                    resources: [
                        "Explore why earth building interests you - is it more than a passing curiosity?",
                        "Read about others' experiences with rammed earth and natural building",
                        "Consider attending a workshop or site visit to see if this resonates with you",
                        "Take time before committing to a consultation"
                    ]
                }
            };

            return responses[level];
        }
        
        function generateTechResponse(level, email) {
            const responses = {
                'redirect-to-directory': {
                    title: "I Understand Your Need",
                    content: "Thank you for your detailed responses. From what you've shared, it seems you're looking for project execution support rather than knowledge transfer.",
                    action: "I can connect you with experienced contractors from my curated directory who provide rammed earth construction services.",
                    class: "directory",
                    showDirectory: true
                },
                'unwilling-hands-on': {
                    title: "Let's Be Honest About What This Takes",
                    content: "I appreciate your interest in rammed earth technology. However, effective knowledge transfer requires professionals who are ready to personally engage with materials and processes, not just oversee them.",
                    action: "This approach works only when you're willing to get your hands dirty alongside your team. If that's not your working style, you'd be better served by contractors who handle execution.",
                    class: "red-flag",
                    resources: [
                        "Consider your role - are you ready for hands-on learning?",
                        "If you prefer oversight-only, contact me for contractor referrals",
                        "Reflect on what kind of involvement feels right for you",
                        "Reach out again if your approach changes"
                    ]
                },
                'no-hands-on-response': {
                    title: "I Need to Understand Your Approach Better",
                    content: "Your response about hands-on involvement was quite brief. To assess whether technology transfer is right for you, I need a clearer picture of your relationship with materials and making.",
                    action: "Could you share more about how comfortable you are with direct material engagement?",
                    class: "red-flag",
                    resources: [
                        "Describe your comfort level getting hands dirty with materials",
                        "Explain how you typically learn new building techniques",
                        "Share any past experiences working directly with construction materials",
                        "Feel free to resubmit with more detailed responses"
                    ]
                },
                'qualified-professional': {
                    title: "This Could Work Well",
                    content: "Your responses show both the hands-on understanding and professional seriousness needed for meaningful technology transfer.",
                    action: "I'll contact you within a week to discuss your specific needs and how we might work together.",
                    class: "proceed",
                    showContact: true
                },
                'developing-professional': {
                    title: "You're Heading in the Right Direction",
                    content: "I can see your genuine professional interest and willingness to engage. What would help you most now is more specific hands-on experience before we dive into technology transfer.",
                    action: "Work through these steps, then let's talk again.",
                    class: "proceed",
                    resources: [
                        "Get direct experience with soil testing and earth material properties",
                        "Work hands-on with at least one natural building project",
                        "Develop specific technical questions about rammed earth processes",
                        "Reach out when you have concrete technical challenges to solve"
                    ]
                },
                'willing-beginner-professional': {
                    title: "Your Willingness Matters",
                    content: "Thank you for being honest about where you are. Your willingness to engage hands-on is exactly the right foundation - that matters more than existing experience.",
                    action: "Start with some basic hands-on experience, then we can discuss how professional knowledge transfer might work for you.",
                    class: "proceed",
                    resources: [
                        "Begin with simple earth material experiments on a small scale",
                        "Attend a hands-on natural building workshop to get tactile experience",
                        "Document your learning process and the questions that arise",
                        "Contact me again after you've gotten your hands dirty"
                    ]
                },
                'not-qualified': {
                    title: "Let's Find the Right Starting Point",
                    content: "I appreciate you reaching out. Based on your responses, there's some groundwork that would help before technology transfer makes sense.",
                    action: "Here's where to begin. These aren't rejections - they're invitations to build the foundation you'll need.",
                    class: "red-flag",
                    resources: [
                        "Clarify what hands-on involvement means for you and your practice",
                        "Take a workshop or short course in natural building",
                        "Develop specific technical questions about rammed earth",
                        "Consider whether the consultation track might be a better fit for now"
                    ]
                }
            };
            
            return responses[level];
        }
        
        // Validate response length and quality
        function validateResponse(text, minLength = 80) {
            return text.trim().length >= minLength;
        }
        
        function showValidationError(field, message) {
            // Remove any existing error
            const existingError = field.parentElement.querySelector('.validation-error');
            if (existingError) existingError.remove();
            
            // Create new error message
            const error = document.createElement('div');
            error.className = 'validation-error';
            error.style.cssText = 'color: #D32F2F; font-size: 0.9em; margin-top: 8px; padding: 10px; background: #FFEBEE; border-radius: 3px; border-left: 3px solid #D32F2F;';
            error.textContent = message;
            field.parentElement.appendChild(error);
            
            // Scroll to error
            error.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }
        
        function clearValidationErrors() {
            document.querySelectorAll('.validation-error').forEach(err => err.remove());
        }
        
        // Handle consultation form
        document.getElementById('consultation-form').addEventListener('submit', function(e) {
            e.preventDefault();
            clearValidationErrors();
            
            const tried = this.querySelector('[name="tried"]').value;
            const why = this.querySelector('[name="why"]').value;
            const hurdle = this.querySelector('[name="hurdle"]').value;
            const failure = this.querySelector('[name="failure"]').value || '';
            const email = this.querySelector('[type="email"]').value;
            
            // Validate response lengths
            if (!validateResponse(tried, 50)) {
                showValidationError(this.querySelector('[name="tried"]'), 'Please provide more detail (at least 50 characters). Help us understand your experience or what draws you to earth building.');
                return;
            }
            
            if (!validateResponse(why, 50)) {
                showValidationError(this.querySelector('[name="why"]'), 'Please explain your motivations in more detail (at least 50 characters). What specifically calls you to this material?');
                return;
            }
            
            if (!validateResponse(hurdle, 40)) {
                showValidationError(this.querySelector('[name="hurdle"]'), 'Please describe your primary hurdle in more detail (at least 40 characters). What specifically is holding you back?');
                return;
            }
            
            const answers = [tried, why, hurdle, failure];

            const result = analyzeResponse(answers);

            // Submit to Google Sheets via Apps Script
            submitToGoogleSheet('consultation', {
                email: email,
                tried: answers[0],
                why: answers[1],
                hurdle: answers[2],
                failure: answers[3],
                level: result.level,
                score: result.debug.percentScore,
                flags: result.debug.flags.join('; '),
                reasoning: result.debug.reasoning.join('; ')
            });

            // Store email in session storage for landing page
            sessionStorage.setItem('consultationEmail', email);
            sessionStorage.setItem('consultationLevel', result.level);
            sessionStorage.setItem('consultationScore', result.debug.percentScore);

            // Redirect to appropriate landing page
            const landingPage = consultationLandingPages[result.level];
            if (landingPage) {
                window.location.href = landingPage;
            } else {
                // Fallback to inline display if no landing page exists
                const response = generateConsultationResponse(result.level, email, result.debug);
                displayResponse('response', response, email, result.debug);

                // Clear form fields
                this.reset();
                document.getElementById('failure-question').style.display = 'none';

                // Disable form temporarily
                const submitBtn = this.querySelector('.submit-btn');
                submitBtn.disabled = true;
                submitBtn.textContent = 'Sent';
                setTimeout(() => {
                    submitBtn.disabled = false;
                    submitBtn.textContent = 'Send';
                }, 3000);
            }
        });
        
        // Handle workshop form
        document.getElementById('workshop-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const data = {
                name: this.querySelector('[type="text"]').value,
                email: this.querySelector('[type="email"]').value,
                location: this.querySelectorAll('[type="text"]')[1].value
            };
            
            const responseDiv = document.getElementById('workshop-response');
            responseDiv.innerHTML = `
                <h3>Added to Workshop List</h3>
                <p>I'll notify you when workshops form in your region.</p>
                <p style="font-style: italic;">Registered: ${data.email}</p>
            `;
            responseDiv.className = 'response-message visible proceed';
            responseDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            
            // Submit to Google Sheets via Apps Script
            submitToGoogleSheet('workshop', data);
            
            // Clear form fields
            this.reset();
            
            // Disable form temporarily
            const submitBtn = this.querySelector('.submit-btn');
            submitBtn.disabled = true;
            submitBtn.textContent = 'Registered';
            setTimeout(() => {
                submitBtn.disabled = false;
                submitBtn.textContent = 'Notify Me of Workshops';
            }, 3000);
        });
        
        // Handle tech transfer submission
        function handleTechSubmit() {
            const form = document.getElementById('tech-transfer-form');
            const checkbox = document.getElementById('accept-terms');
            const errorMsg = document.getElementById('terms-error');
            
            clearValidationErrors();
            
            // Check if terms are accepted
            if (!checkbox.checked) {
                errorMsg.style.display = 'block';
                errorMsg.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                return;
            }
            
            const email = form.querySelector('[type="email"]').value;
            const role = form.querySelector('[name="role"]').value;
            const handsOn = form.querySelector('[name="hands-on"]').value;
            const technology = form.querySelector('[name="technology"]').value;
            const application = form.querySelector('[name="application"]').value;
            
            // Validate response lengths
            if (!validateResponse(handsOn, 60)) {
                showValidationError(form.querySelector('[name="hands-on"]'), 'Please provide more detail about your hands-on experience or willingness (at least 60 characters). Share specific examples.');
                return;
            }
            
            if (!validateResponse(technology, 50)) {
                showValidationError(form.querySelector('[name="technology"]'), 'Please be more specific about the technology you want to learn (at least 50 characters). What exact processes or techniques?');
                return;
            }
            
            if (!validateResponse(application, 50)) {
                showValidationError(form.querySelector('[name="application"]'), 'Please explain how you\'ll use this knowledge in more detail (at least 50 characters). What\'s your plan?');
                return;
            }
            
            const answers = [role, handsOn, technology, application];

            const result = analyzeTechTransfer(answers);
            const response = generateTechResponse(result.level, email, result.debug);

            displayResponse('tech-response', response, email, result.debug);

            // Submit to Google Sheets via Apps Script
            submitToGoogleSheet('tech-transfer', {
                email: email,
                role: answers[0],
                handsOn: answers[1],
                technology: answers[2],
                application: answers[3],
                level: result.level,
                score: result.debug.percentScore,
                breakdown: result.debug.breakdown ? JSON.stringify(result.debug.breakdown) : '',
                flags: result.debug.flags.join('; '),
                reasoning: result.debug.reasoning.join('; ')
            });
            
            // Clear form fields
            form.reset();
            checkbox.checked = false;
            
            // Disable button temporarily
            const submitBtn = document.getElementById('tech-submit-btn');
            submitBtn.disabled = true;
            submitBtn.textContent = 'Submitted';
            setTimeout(() => {
                submitBtn.textContent = 'Submit for Review';
                // Keep disabled until checkbox is checked again
            }, 3000);
        }
        
        // Handle tech transfer form (remove old handler)
        document.getElementById('tech-transfer-form').addEventListener('submit', function(e) {
            e.preventDefault();
            // Form submission now handled by button click
        });
        
        function displayResponse(divId, response, email, debug) {
            const responseDiv = document.getElementById(divId);
            let responseHTML = `
                <h3>${response.title}</h3>
                <p>${response.content}</p>
                <p><strong>${response.action}</strong></p>
            `;

            if (response.resources) {
                responseHTML += `
                    <div class="resource-list">
                        <ul>
                            ${response.resources.map(r => `<li>${r}</li>`).join('')}
                        </ul>
                    </div>
                `;
            }

            if (response.showContact) {
                responseHTML += `<p style="margin-top: 20px; font-style: italic;">I'll email you at: ${email}</p>`;
            }

            if (response.showDirectory) {
                responseHTML += `<a href="#" class="directory-link" onclick="requestDirectory('${email}'); return false;">Access Contractor Directory</a>`;
            }

            // Add debug information (collapsible)
            if (debug && window.location.search.includes('debug=true')) {
                responseHTML += `
                    <div style="margin-top: 25px; padding: 15px; background: #f5f5f5; border: 1px solid #ccc; border-radius: 5px; font-size: 0.85em;">
                        <strong onclick="this.nextElementSibling.style.display = this.nextElementSibling.style.display === 'none' ? 'block' : 'none'" style="cursor: pointer; color: #666;">
                            🔍 Debug Info (click to toggle)
                        </strong>
                        <div style="display: none; margin-top: 10px;">
                            <p><strong>Score:</strong> ${debug.totalScore}/${debug.maxScore} (${debug.percentScore}%)</p>
                            ${debug.breakdown ? `<p><strong>Breakdown:</strong> ${JSON.stringify(debug.breakdown)}</p>` : ''}
                            <p><strong>Detailed Scores:</strong></p>
                            <ul style="margin-left: 20px; list-style: disc;">
                                ${Object.entries(debug.scores).map(([key, value]) => `<li>${key}: ${value}</li>`).join('')}
                            </ul>
                            ${debug.flags.length > 0 ? `
                                <p><strong>Flags:</strong></p>
                                <ul style="margin-left: 20px; list-style: disc; color: #d32f2f;">
                                    ${debug.flags.map(flag => `<li>${flag}</li>`).join('')}
                                </ul>
                            ` : ''}
                            ${debug.reasoning.length > 0 ? `
                                <p><strong>Reasoning:</strong></p>
                                <ul style="margin-left: 20px; list-style: disc;">
                                    ${debug.reasoning.map(reason => `<li>${reason}</li>`).join('')}
                                </ul>
                            ` : ''}
                        </div>
                    </div>
                `;
            }

            responseDiv.innerHTML = responseHTML;
            responseDiv.className = `response-message visible ${response.class}`;
            responseDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }
        
        function requestDirectory(email) {
            alert('Directory request sent! I\'ll email you the contractor list within 24 hours.');
            console.log('Directory requested by:', email);
        }
        
        // Google Apps Script submission function
        function submitToGoogleSheet(formType, data) {
            const scriptUrls = {
                'consultation': 'https://script.google.com/macros/s/AKfycbxDxdp8mmtLBFW_Pz87p07HqDS28wvVNtE3lEMVM3T1bVhLHXdIAWebT9hYA-bZkaP5aQ/exec',
                'workshop': 'https://script.google.com/macros/s/AKfycbxmybW_ziIp5AjE1_RPqHdulByjeeg7L1LumAKwtwfK8S_IALSgLMh9TV8KfHZdVR7fhQ/exec',
                'tech-transfer': 'https://script.google.com/macros/s/AKfycbysYqnsBhSsoaiNobJMAcyFtYrEjkFVDbwwi-BJQd_LzdyMjb4kGQywh-5fQPvCEhiJ/exec'
            };
            
            const scriptUrl = scriptUrls[formType];
            
            // Submit to Google Apps Script
            fetch(scriptUrl, {
                method: 'POST',
                mode: 'no-cors',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data)
            }).then(() => {
                console.log(`${formType} form submitted successfully to Google Sheets`);
            }).catch(error => {
                console.error(`${formType} form submission error:`, error);
            });
        }
    </script>
</body>
</html>
